
#include <iostream>
#include <Eigen/Dense>

using namespace Eigen;
using namespace std;

MatrixXd computePositiveDifference(const MatrixXd& matrix1, const MatrixXd& matrix2) {

    MatrixXd difference = matrix1 - matrix2;


    difference = difference.array().abs();

    return difference;
}

double calculateAveragePercentageError(const MatrixXd& matrix1, const MatrixXd& matrix2) {
    double totalError = 0.0;
    int numElements = matrix1.size();

    for (int i = 0; i < matrix1.rows(); ++i) {
        for (int j = 0; j < matrix1.cols(); ++j) {
            double error = abs((matrix1(i, j) - matrix2(i, j)) / matrix1(i, j)) * 100.0;
            totalError += error;
        }
    }

    return totalError / numElements;
}
double calculateFrobeniusNormError(const MatrixXd& matrix1, const MatrixXd& matrix2) {
    MatrixXd differenceMatrix = matrix1 - matrix2; // Calculate the difference matrix
    double frobeniusNorm = differenceMatrix.norm(); // Calculate the Frobenius norm
    return frobeniusNorm;
}
int main() {

    // Define the original 24x24 matrix A (low-rank and positive semi-definite)

    int rank = 4;
    int size = 32;
    int rs = size - rank;
    MatrixXd kernel(size, size); // Create a 16x16 MatrixXd
    // Fill the matrix with some values (this is just an example)
    kernel << 44.98, 30.35, 39.81, 41.79, 36.94, 36.25, 34.95, 41.45, 45.34, 62.74, 61.87, 19.86, 49.75, 15.74, 33.35, 47.80, 60.22, 36.28, 34.85, 39.94, 32.93, 49.49, 29.21, 42.90, 43.67, 42.29, 24.03, 47.93, 30.71, 35.89, 41.84, 32.73,
        30.35, 20.63, 26.53, 28.32, 25.19, 24.68, 23.79, 27.79, 30.32, 42.35, 41.89, 13.40, 33.85, 10.63, 22.08, 32.13, 40.80, 24.33, 23.35, 27.00, 22.55, 33.21, 19.75, 28.98, 29.81, 28.65, 16.24, 32.40, 21.15, 24.11, 28.35, 22.13,
        39.81, 26.53, 36.23, 36.56, 32.70, 31.97, 30.20, 36.96, 40.97, 55.75, 54.77, 17.67, 43.77, 14.26, 30.31, 43.09, 53.21, 33.12, 31.83, 35.27, 28.22, 44.45, 26.37, 38.71, 38.43, 37.57, 21.66, 42.82, 26.96, 32.65, 36.60, 28.89,
        41.79, 28.32, 36.56, 39.07, 34.08, 33.53, 32.83, 38.50, 41.68, 58.15, 57.43, 18.50, 46.06, 14.37, 30.78, 43.86, 55.84, 33.23, 31.91, 36.99, 30.96, 45.55, 26.78, 39.47, 40.69, 38.92, 22.03, 44.27, 28.44, 32.90, 38.96, 30.52,
        36.94, 25.19, 32.70, 34.08, 32.16, 31.09, 28.47, 33.41, 37.52, 52.07, 51.57, 16.19, 42.46, 13.72, 26.36, 40.42, 50.48, 30.74, 29.46, 33.34, 27.23, 41.21, 25.29, 36.64, 37.00, 36.30, 20.78, 40.43, 27.27, 30.46, 34.53, 26.74,
        36.25, 24.68, 31.97, 33.53, 31.09, 30.21, 28.08, 32.89, 36.68, 50.92, 50.36, 15.83, 41.34, 13.22, 26.04, 39.32, 49.29, 29.73, 28.51, 32.68, 26.80, 40.28, 24.39, 35.40, 35.90, 35.31, 20.08, 39.31, 26.20, 29.46, 33.97, 26.22,
        34.95, 23.79, 30.20, 32.83, 28.47, 28.08, 27.72, 32.08, 34.55, 48.53, 47.99, 15.40, 38.63, 11.88, 25.46, 36.39, 46.72, 27.36, 26.28, 31.00, 26.24, 37.87, 22.16, 32.66, 34.03, 32.52, 18.26, 36.84, 23.80, 27.14, 32.77, 25.52,
        41.45, 27.79, 36.96, 38.50, 33.41, 32.89, 32.08, 38.51, 41.87, 57.70, 56.81, 18.44, 45.15, 14.32, 31.31, 43.81, 55.10, 33.48, 32.17, 36.50, 30.00, 45.52, 26.65, 39.37, 39.95, 38.35, 21.90, 43.96, 27.60, 33.05, 38.29, 30.25,
        45.34, 30.32, 40.97, 41.68, 37.52, 36.68, 34.55, 41.87, 46.51, 63.47, 62.39, 19.95, 50.26, 16.26, 34.13, 49.11, 60.79, 37.44, 35.97, 40.41, 32.45, 50.63, 30.02, 43.89, 43.74, 43.16, 24.71, 48.73, 30.96, 36.96, 41.96, 32.80,
        62.74, 42.35, 55.75, 58.15, 52.07, 50.92, 48.53, 57.70, 63.47, 87.74, 86.57, 27.74, 69.77, 22.26, 46.38, 67.15, 84.28, 51.17, 49.12, 55.79, 45.78, 69.29, 41.27, 60.51, 61.34, 59.41, 33.92, 67.30, 43.46, 50.59, 58.26, 45.64,
        61.87, 41.89, 54.77, 57.43, 51.57, 50.36, 47.99, 56.81, 62.39, 86.57, 85.55, 27.44, 68.95, 21.99, 45.45, 66.12, 83.24, 50.50, 48.46, 54.96, 45.33, 68.16, 40.81, 59.87, 60.92, 58.58, 33.50, 66.49, 43.27, 49.94, 57.43, 45.11,
        19.86, 13.40, 17.67, 18.50, 16.19, 15.83, 15.40, 18.44, 19.95, 27.74, 27.44, 9.03, 21.64, 6.93, 14.86, 20.94, 26.48, 16.31, 15.66, 17.30, 14.39, 21.66, 12.97, 19.28, 19.69, 18.23, 10.58, 21.28, 13.63, 16.08, 18.16, 14.66,
        49.75, 33.85, 43.77, 46.06, 42.46, 41.34, 38.63, 45.15, 50.26, 69.77, 68.95, 21.64, 56.66, 18.01, 35.76, 53.81, 67.55, 40.47, 38.82, 44.90, 36.87, 55.23, 33.22, 48.20, 48.96, 48.39, 27.39, 53.72, 35.65, 40.14, 46.75, 35.93,
        15.74, 10.63, 14.26, 14.37, 13.72, 13.22, 11.88, 14.32, 16.26, 22.26, 21.99, 6.93, 18.01, 5.97, 11.48, 17.49, 21.49, 13.45, 12.89, 14.18, 11.29, 17.78, 10.96, 15.88, 15.71, 15.52, 8.99, 17.37, 11.57, 13.28, 14.56, 11.37,
        33.35, 22.08, 30.31, 30.78, 26.36, 26.04, 25.46, 31.31, 34.13, 46.38, 45.45, 14.86, 35.76, 11.48, 25.95, 35.41, 43.99, 27.17, 26.15, 29.24, 23.57, 36.89, 21.33, 31.59, 31.55, 30.57, 17.54, 35.24, 21.42, 26.75, 30.58, 24.28,
        47.80, 32.13, 43.09, 43.86, 40.42, 39.32, 36.39, 43.81, 49.11, 67.15, 66.12, 20.94, 53.81, 17.49, 35.41, 52.27, 64.59, 39.78, 38.19, 42.91, 34.41, 53.61, 32.20, 46.83, 46.61, 46.28, 26.50, 51.82, 33.61, 39.31, 44.40, 34.49,
        60.22, 40.80, 53.21, 55.84, 50.48, 49.29, 46.72, 55.10, 60.79, 84.28, 83.24, 26.48, 67.55, 21.49, 43.99, 64.59, 81.21, 48.98, 47.01, 53.82, 44.28, 66.54, 39.78, 58.12, 59.08, 57.53, 32.73, 64.72, 42.27, 48.49, 56.18, 43.72,
        36.28, 24.33, 33.12, 33.23, 30.74, 29.73, 27.36, 33.48, 37.44, 51.17, 50.50, 16.31, 40.47, 13.45, 27.17, 39.78, 48.98, 31.05, 29.79, 32.11, 25.67, 40.64, 24.88, 36.46, 36.11, 34.69, 20.32, 39.77, 25.83, 30.59, 33.13, 26.48,
        34.85, 23.35, 31.83, 31.91, 29.46, 28.51, 26.28, 32.17, 35.97, 49.12, 48.46, 15.66, 38.82, 12.89, 26.15, 38.19, 47.01, 29.79, 28.58, 30.83, 24.63, 39.04, 23.85, 34.96, 34.61, 33.28, 19.48, 38.16, 24.72, 29.34, 31.82, 25.42,
        39.94, 27.00, 35.27, 36.99, 33.34, 32.68, 31.00, 36.50, 40.41, 55.79, 54.96, 17.30, 44.90, 14.18, 29.24, 42.91, 53.82, 32.11, 30.83, 35.97, 29.43, 44.31, 26.14, 38.02, 38.55, 38.41, 21.61, 42.67, 27.64, 31.82, 37.54, 28.78,
        32.93, 22.55, 28.22, 30.96, 27.23, 26.80, 26.24, 30.00, 32.45, 45.78, 45.33, 14.39, 36.87, 11.29, 23.57, 34.41, 44.28, 25.67, 24.63, 29.43, 25.01, 35.72, 21.01, 30.80, 32.22, 31.06, 17.34, 34.81, 22.87, 25.50, 31.10, 23.98,
        49.49, 33.21, 44.45, 45.55, 41.21, 40.28, 37.87, 45.52, 50.63, 69.29, 68.16, 21.66, 55.23, 17.78, 36.89, 53.61, 66.54, 40.64, 39.04, 44.31, 35.72, 55.24, 32.78, 47.80, 47.81, 47.41, 27.01, 53.19, 34.08, 40.17, 46.03, 35.73,
        29.21, 19.75, 26.37, 26.78, 25.29, 24.39, 22.16, 26.65, 30.02, 41.27, 40.81, 12.97, 33.22, 10.96, 21.33, 32.20, 39.78, 24.88, 23.85, 26.14, 21.01, 32.78, 20.22, 29.42, 29.29, 28.49, 16.55, 32.16, 21.40, 24.57, 26.95, 21.21,
        42.90, 28.98, 38.71, 39.47, 36.64, 35.40, 32.66, 39.37, 43.89, 60.51, 59.87, 19.28, 48.20, 15.88, 31.59, 46.83, 58.12, 36.46, 34.96, 38.02, 30.80, 47.80, 29.42, 43.10, 43.12, 41.13, 24.02, 47.06, 31.05, 35.97, 39.34, 31.37,
        43.67, 29.81, 38.43, 40.69, 37.00, 35.90, 34.03, 39.95, 43.74, 61.34, 60.92, 19.69, 48.96, 15.71, 31.55, 46.61, 59.08, 36.11, 34.61, 38.55, 32.22, 47.81, 29.29, 43.12, 44.23, 41.29, 23.91, 47.43, 31.62, 35.71, 40.30, 32.15,
        42.29, 28.65, 37.57, 38.92, 36.30, 35.31, 32.52, 38.35, 43.16, 59.41, 58.58, 18.23, 48.39, 15.52, 30.57, 46.28, 57.53, 34.69, 33.28, 38.41, 31.06, 47.41, 28.49, 41.13, 41.29, 41.62, 23.53, 45.82, 30.29, 34.39, 39.79, 30.35,
        24.03, 16.24, 21.66, 22.03, 20.78, 20.08, 18.26, 21.90, 24.71, 33.92, 33.50, 10.58, 27.39, 8.99, 17.54, 26.50, 32.73, 20.32, 19.48, 21.61, 17.34, 27.01, 16.55, 24.02, 23.91, 23.53, 13.59, 26.38, 17.50, 20.08, 22.28, 17.39,
        47.93, 32.40, 42.82, 44.27, 40.43, 39.31, 36.84, 43.96, 48.73, 67.30, 66.49, 21.28, 53.72, 17.37, 35.24, 51.82, 64.72, 39.77, 38.16, 42.67, 34.81, 53.19, 32.16, 47.06, 47.43, 45.82, 26.38, 51.95, 33.98, 39.30, 44.36, 34.90,
        30.71, 21.15, 26.96, 28.44, 27.27, 26.20, 23.80, 27.60, 30.96, 43.46, 43.27, 13.63, 35.65, 11.57, 21.42, 33.61, 42.27, 25.83, 24.72, 27.64, 22.87, 34.08, 21.40, 31.05, 31.62, 30.29, 17.50, 33.98, 23.54, 25.61, 28.62, 22.40,
        35.89, 24.11, 32.65, 32.90, 30.46, 29.46, 27.14, 33.05, 36.96, 50.59, 49.94, 16.08, 40.14, 13.28, 26.75, 39.31, 48.49, 30.59, 29.34, 31.82, 25.50, 40.17, 24.57, 35.97, 35.71, 34.39, 20.08, 39.30, 25.61, 30.15, 32.86, 26.16,
        41.84, 28.35, 36.60, 38.96, 34.53, 33.97, 32.77, 38.29, 41.96, 58.26, 57.43, 18.16, 46.75, 14.56, 30.58, 44.40, 56.18, 33.13, 31.82, 37.54, 31.10, 46.03, 26.95, 39.34, 40.30, 39.79, 22.28, 44.36, 28.62, 32.86, 39.39, 30.24,
        32.73, 22.13, 28.89, 30.52, 26.74, 26.22, 25.52, 30.25, 32.80, 45.64, 45.11, 14.66, 35.93, 11.37, 24.28, 34.49, 43.72, 26.48, 25.42, 28.78, 23.98, 35.73, 21.21, 31.37, 32.15, 30.35, 17.39, 34.90, 22.40, 26.16, 30.24, 24.01;
    // Define submatrices a, b, c, and d
    MatrixXd A = kernel.block(0, 0, rank, rank); // submatrix a (2x2)
    MatrixXd B = kernel.block(0, rank, rank, rs); // submatrix b (2x14)
    MatrixXd Qorg = kernel.block(rank, rank, rs, rs); // submatrix d (14x14)

    // Display submatrices a, b, c, and d
    cout << "Submatrix a :\n" << A << "\n\n";
    cout << "Submatrix b :\n" << B << "\n\n";
    cout << "Submatrix q :\n" << Qorg << "\n\n";
    MatrixXd Ain(rank, rank);
    MatrixXd Bt(rs, rank);
    MatrixXd Q(rs, rs);

    Ain = A.inverse();
    Bt = B.transpose();
    Q = Bt * Ain * B;

    cout << "final" << endl << Q << endl;
    MatrixXd positiveDifference = computePositiveDifference(Qorg, Q);
    cout << "Difference Matrix with Positive Values:\n" << positiveDifference << "\n";
    double avgPercentageError = calculateAveragePercentageError(Qorg, Q);
    cout << "Average Percentage Error: " << avgPercentageError << "%\n";
    double frobeniusNormError = calculateFrobeniusNormError(Qorg, Q);
    cout << "Frobenius Norm Error: " << frobeniusNormError << "\n";
        return 0;
    }
